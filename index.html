<!DOCTYPE html>
<html lang="ms-MY">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Matematik Ceria: Operasi Tolak & Kaitan Tambah</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    /* --- UI STYLE (TEMPLATE HIJAU - MASTER REFERENCE) --- */
    body { 
        font-family: 'Fredoka', sans-serif; 
        background-color: #f0fdf4; 
        background-image: radial-gradient(#86efac 2px, transparent 2px); 
        background-size: 30px 30px; 
    }
    
    .game-card { 
        background: white; 
        border: 4px solid #475569; 
        box-shadow: 8px 8px 0px #00000020; 
        border-radius: 1.5rem; 
        min-height: 600px; 
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
    }
    
    /* Buttons & Animations */
    .btn-3d { 
        transition: all 0.1s; 
        border-bottom-width: 6px; 
        border-color: rgba(0,0,0,0.2); 
        transform: translateY(0); 
        cursor: pointer; 
        display: inline-block; 
    }
    .btn-3d:active:not(:disabled) { transform: translateY(4px); border-bottom-width: 2px; box-shadow: none; }
    .btn-3d:disabled { opacity: 0.6; cursor: not-allowed; border-bottom-width: 6px; filter: grayscale(100%); }

    .shake { animation: shake 0.4s ease-in-out; border-color: #ef4444 !important; background-color: #fee2e2 !important; }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px) rotate(-5deg); } 75% { transform: translateX(8px) rotate(5deg); } }

    /* --- DRAG & DROP STYLES (DARI KOD KEDUA) --- */
    .drop-zone { border: 3px dashed #94a3b8; background-color: #f8fafc; transition: all .3s ease; border-radius: 1rem; min-height: 60px; }
    .drop-zone.drag-over { border-color: #22c55e; background-color: #dcfce7; transform: scale(1.02); }
    .drop-zone-filled { border: 3px solid #22c55e; background-color: #dcfce7; }
    .dragging { opacity: 0.5; transform: rotate(5deg) scale(1.1); }
    
    .number-card { transition: all 0.2s; cursor: grab; user-select: none; }
    .number-card:active { cursor: grabbing; }

    /* --- STYLE KHUSUS AKTIVITI --- */
    
    /* Aktiviti 2: Rumah Fakta */
    .roof-wrap { position:relative; width:212px; height:120px; margin: 0 auto; }
    .roof-svg { display:block; width:212px; height:120px; }
    #house-roof {
      position:absolute; inset:0;
      clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
      background: transparent;
      display:flex; align-items:center; justify-content:center;
      font-weight:700; font-size:1.8rem; color: #374151; padding-top: 35px;
    }

    /* Aktiviti 3: Mesin Tolak (Konsisten dgn Master Reference) */
    .lazim-box { 
      width: 70px; height: 80px; 
      display: flex; align-items: center; justify-content: center; 
      font-size: 2.5rem; font-weight: bold; color: #1e293b;
      border: 3px solid #cbd5e1; border-radius: 0.75rem;
      background-color: white; position: relative;
    }
    .lazim-box.pinjam { color: #ef4444; text-decoration: line-through; opacity: 0.5; background: #fee2e2; border-color: #ef4444; }
    .lazim-box.dapat { color: #15803d; background: #dcfce7; border-color: #22c55e; animation: pop 0.3s ease; }
    
    /* Label Pinjam (Hijau Kecil Atas) */
    .num-atas {
        position: absolute; top: -20px; right: -10px;
        background: #dcfce7; border: 2px solid #22c55e; color: #15803d;
        font-size: 1.2rem; padding: 0 6px; border-radius: 6px; z-index: 10;
    }

    /* Aktiviti 4: Bedah Cerita */
    .clickable-word { cursor: pointer; border-bottom: 3px dotted #f97316; transition: all 0.2s; }
    .clickable-word:hover { background-color: #ffedd5; color: #c2410c; transform: translateY(-2px); }
    
    @keyframes pop { 0% { transform: scale(0.8); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

  </style>
</head>
<body class="min-h-screen text-slate-800 pb-10">

  <div class="fixed top-4 left-0 right-0 z-50 px-4 pointer-events-none">
    <div class="max-w-4xl mx-auto bg-green-400 border-4 border-green-600 rounded-full px-6 py-3 shadow-xl flex items-center justify-between pointer-events-auto transform hover:scale-[1.01] transition-transform">
      <div class="flex items-center gap-3">
        <span class="text-3xl animate-bounce">‚ûñ</span>
        <span id="info-text" class="text-xl font-bold text-green-900 leading-none mt-1">Operasi Tolak & Kaitan Tambah</span>
      </div>
      <button id="speak-btn" onclick="speakInfo()" class="bg-white hover:bg-green-50 text-green-600 border-2 border-green-200 rounded-full p-2 transition-colors shadow-sm">üîä</button>
    </div>
  </div>
  <div class="h-24"></div>

  <div class="max-w-6xl mx-auto p-4">
    
    <div class="game-card p-8 mb-8">
        <div id="activity-content" class="w-full relative z-10">
            <div class="py-10 text-center">
                <div class="text-8xl mb-6 animate-pulse">üßÆ</div>
                <h2 class="text-5xl font-bold text-emerald-600 mb-4">Operasi Tolak</h2>
                <p class="text-2xl text-slate-500 mb-8 font-semibold">Jom teroka kaitan dengan Tambah!</p>
                <div class="text-4xl animate-bounce">üëá</div>
            </div>
        </div>
    </div>

    <div class="bg-white/80 backdrop-blur-sm rounded-3xl shadow-lg p-6 border-2 border-white">
      <h3 class="text-2xl font-bold text-slate-700 mb-4 text-center">üéÆ Pilih Aktiviti</h3>
      
      <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-8">
        <button onclick="loadActivity(1)" class="btn-3d bg-blue-500 text-white font-bold py-4 px-2 rounded-xl text-lg">üìè Pembaris Ajaib</button>
        <button onclick="loadActivity(2)" class="btn-3d bg-emerald-500 text-white font-bold py-4 px-2 rounded-xl text-lg">üè† Keluarga Fakta</button>
        <button onclick="loadActivity(3)" class="btn-3d bg-violet-500 text-white font-bold py-4 px-2 rounded-xl text-lg">üî¢ Mesin Tolak</button>
        <button onclick="loadActivity(4)" class="btn-3d bg-orange-500 text-white font-bold py-4 px-2 rounded-xl text-lg">üçé Bedah Cerita</button>
        <button onclick="loadActivity(5)" class="btn-3d bg-rose-500 text-white font-bold py-4 px-2 rounded-xl text-lg">‚úèÔ∏è Bina Cerita</button>
      </div>

      <div class="flex justify-center gap-4 border-t-2 border-slate-100 pt-6">
        <button onclick="clearActivity()" class="btn-3d bg-slate-400 text-white font-bold py-2 px-6 rounded-full text-lg">üè† Menu</button>
        <button onclick="nextActivity()" class="btn-3d bg-indigo-500 text-white font-bold py-2 px-8 rounded-full text-xl">Seterusnya ‚û°Ô∏è</button>
      </div>
    </div>
  </div>

  <script>
    /* --- STANDARD HELPERS --- */
    let currentActivity = 0;
    let ttsEnabled = false;
    let currentInfo = "Selamat datang! Pilih aktiviti.";
    let draggedElement = null; // Untuk Drag & Drop

    function triggerWin() { confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } }); }

    function speak(text) { 
        if (!ttsEnabled || !('speechSynthesis' in window)) return; 
        window.speechSynthesis.cancel(); 
        const u = new SpeechSynthesisUtterance(text); 
        u.lang = 'ms-MY'; u.rate = 0.9; u.pitch = 1.1; 
        const voices = window.speechSynthesis.getVoices(); 
        const ms = voices.find(v => v.lang === 'ms-MY' || v.lang?.startsWith('ms')); 
        if (ms) u.voice = ms; 
        window.speechSynthesis.speak(u); 
    }
    
    function setInfo(text) { 
        currentInfo = text; 
        const infoEl = document.getElementById('info-text'); 
        infoEl.style.opacity = 0; 
        setTimeout(() => { infoEl.textContent = text; infoEl.style.opacity = 1; }, 200); 
    }
    
    function speakInfo() { 
        if (!ttsEnabled) { 
            ttsEnabled = true; 
            document.getElementById('speak-btn').classList.add('bg-green-100', 'text-green-600'); 
        } 
        speak(currentInfo); 
    }

    /* --- DRAG & DROP LOGIC (Global) --- */
    window.dragStart = function(e) { draggedElement = e.target; e.target.classList.add('dragging'); }
    
    window.dragEnd = function(e) { 
        e.target.classList.remove('dragging'); 
        document.querySelectorAll('.drop-zone').forEach(z => z.classList.remove('drag-over'));
        // Reset warna bumbung jika ada
        const poly = document.getElementById('roof-poly');
        const roof = document.getElementById('house-roof');
        if (poly && roof) {
            const filled = roof.classList.contains('drop-zone-filled');
            poly.setAttribute('stroke', filled ? '#22c55e' : '#94a3b8');
        }
    }

    window.allowDrop = function(e) { 
        e.preventDefault(); 
        if (e.currentTarget.id === 'house-roof') {
            const poly = document.getElementById('roof-poly');
            if (poly) poly.setAttribute('stroke', '#3b82f6'); 
        } else if (e.currentTarget.classList.contains('drop-zone')) {
            e.currentTarget.classList.add('drag-over'); 
        }
    }

    window.dragLeave = function(e) { 
        if (e.currentTarget.id === 'house-roof') {
            const poly = document.getElementById('roof-poly');
            const filled = e.currentTarget.classList.contains('drop-zone-filled');
            if (poly) poly.setAttribute('stroke', filled ? '#22c55e' : '#94a3b8');
        } else if (e.currentTarget.classList.contains('drop-zone')) {
            e.currentTarget.classList.remove('drag-over');
        }
    }

    /* --- ROUTER --- */
    function loadActivity(n) {
      currentActivity = n;
      const content = document.getElementById('activity-content');
      content.style.opacity = 0;
      setTimeout(() => {
          if (n === 1) loadBarActivity(content);
          if (n === 2) loadFactFamilyActivity(content);
          if (n === 3) loadBentukLazimActivity(content);
          if (n === 4) loadWordProblemActivity(content);
          if (n === 5) loadStoryBuilderActivity(content);
          content.style.opacity = 1;
      }, 200);
    }

    function clearActivity() {
        currentActivity = 0;
        document.getElementById('activity-content').innerHTML = `<div class="py-10 text-center"><div class="text-8xl mb-6 animate-pulse">üßÆ</div><h2 class="text-5xl font-bold text-emerald-600 mb-4">Operasi Tolak</h2><p class="text-2xl text-slate-500 mb-8 font-semibold">Jom teroka operasi tolak dan kaitan dengan tambah.</p></div>`;
        setInfo("Pilih aktiviti untuk mula belajar!");
    }
    function nextActivity() { let next = currentActivity + 1; if (next > 5) next = 1; loadActivity(next); }


    /* =========================================
       LOGIK AKTIVITI (GABUNGAN BARU)
       ========================================= */

    /* 1. Pembaris Ajaib */
    function loadBarActivity(content) {
      setInfo("Seret blok 300 dan 400 ke pembaris.");
      content.innerHTML = `
        <h3 class="text-4xl font-bold text-blue-500 mb-6 text-center">üìè Pembaris Ajaib</h3>
        <div class="bg-blue-50 rounded-3xl p-8 border-4 border-blue-200">
            <p class="text-center text-slate-500 font-bold mb-4">Seret blok nombor ke bawah:</p>
            <div id="number-choices" class="flex flex-wrap justify-center gap-4 mb-12">
              <div class="number-card btn-3d bg-white border-2 border-blue-400 rounded-2xl p-4 text-3xl font-bold text-blue-600 shadow-md"
                   draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-number="300" style="width: 150px; text-align:center;">300</div>
              <div class="number-card btn-3d bg-white border-2 border-blue-400 rounded-2xl p-4 text-3xl font-bold text-blue-600 shadow-md"
                   draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-number="400" style="width: 200px; text-align:center;">400</div>
            </div>
            
            <div class="bg-white p-6 rounded-2xl border-2 border-slate-200">
                <p class="text-slate-400 font-bold mb-2">Letak di sini:</p>
                <div id="bar-track" class="flex items-center justify-start w-full bg-slate-100 rounded-xl p-2 min-h-[100px] drop-zone"
                     ondrop="dropOnBar(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)"></div>
                <div id="bar-result" class="mt-4 text-center min-h-[60px]"></div>
            </div>
        </div>
      `;
    }
    
    window.dropOnBar = function(e) {
      e.preventDefault(); e.currentTarget.classList.remove('drag-over'); if (!draggedElement) return;
      e.currentTarget.appendChild(draggedElement);
      draggedElement.setAttribute('draggable','false'); draggedElement.style.cursor = 'default'; draggedElement.classList.remove('shadow-md', 'btn-3d');

      const track = document.getElementById('bar-track');
      const result = document.getElementById('bar-result');
      if (track.children.length === 2) {
        result.innerHTML = `<div class="animate-bounce inline-block text-5xl">üéâ</div><div class="text-3xl font-bold text-blue-600 mt-2">300 + 400 = 700</div>`;
        setInfo("Bagus! 300 tambah 400 jadi 700."); speak("Bagus! 300 tambah 400 sama dengan 700.");
        track.classList.add('drop-zone-filled');
        triggerWin();
      }
    }

    /* 2. Keluarga Fakta */
    function loadFactFamilyActivity(content) {
      setInfo("Nombor besar di bumbung, nombor kecil di bilik.");
      const numbers = [700, 300, 400];
      content.innerHTML = `
        <h3 class="text-4xl font-bold text-emerald-500 mb-6 text-center">üè† Keluarga Fakta</h3>
        <div class="bg-emerald-50 rounded-3xl p-6 border-4 border-emerald-200 max-w-2xl mx-auto">
           <div id="number-choices" class="flex flex-wrap justify-center gap-4 mb-8 min-h-[80px]">
            ${numbers.sort(()=>Math.random()-0.5).map(num => `
              <div class="btn-3d bg-white border-emerald-400 text-emerald-700 border-b-4 rounded-xl p-3 text-2xl font-bold number-card"
                   draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-number="${num}" data-type="${num === 700 ? 'whole' : 'part'}">${num}</div>
            `).join('')}
          </div>

          <div class="flex flex-col items-center relative">
            <div class="roof-wrap">
              <svg id="roof-svg" class="roof-svg" viewBox="0 0 212 120">
                <polygon id="roof-poly" points="106,0 0,120 212,120" fill="#ffffff" stroke="#94a3b8" stroke-width="4"/>
              </svg>
              <div id="house-roof" class="drop-zone" ondrop="dropOnHouse(event, 'whole')" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">__</div>
            </div>
            <div class="flex gap-1 -mt-1">
              <div id="house-part1" class="drop-zone bg-white flex items-center justify-center font-bold text-2xl text-slate-600" style="width: 104px; height: 100px; border-radius: 0 0 0 1rem;" ondrop="dropOnHouse(event, 'part')" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">__</div>
              <div id="house-part2" class="drop-zone bg-white flex items-center justify-center font-bold text-2xl text-slate-600" style="width: 104px; height: 100px; border-radius: 0 0 1rem 0;" ondrop="dropOnHouse(event, 'part')" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">__</div>
            </div>
          </div>
          <div id="fact-family-result" class="mt-6 min-h-[100px]"></div>
        </div>
      `;
    }

    window.dropOnHouse = function(e, dropZoneType) {
      e.preventDefault(); e.currentTarget.classList.remove('drag-over'); if (!draggedElement) return;
      const draggedType = draggedElement.dataset.type;
      const draggedNumber = draggedElement.dataset.number;

      if (draggedType === dropZoneType) {
        e.currentTarget.innerHTML = draggedNumber;
        e.currentTarget.classList.add('drop-zone-filled');
        if (dropZoneType === 'whole') {
             const poly = document.getElementById('roof-poly');
             if (poly) poly.setAttribute('stroke', '#22c55e');
        }
        draggedElement.remove(); draggedElement = null;
        checkFactFamily();
      } else {
        const msg = dropZoneType === 'whole' ? "Bumbung untuk nombor paling besar!" : "Bilik untuk nombor kecil!";
        setInfo(msg); speak(msg);
        e.currentTarget.classList.add('shake'); setTimeout(()=>e.currentTarget.classList.remove('shake'), 500);
      }
    }

    function checkFactFamily() {
      const roof = document.getElementById('house-roof').innerHTML;
      const part1 = document.getElementById('house-part1').innerHTML;
      const part2 = document.getElementById('house-part2').innerHTML;
      if (roof !== "__" && part1 !== "__" && part2 !== "__") {
        const resultEl = document.getElementById('fact-family-result');
        resultEl.innerHTML = `
          <div class="bg-emerald-100 border-2 border-emerald-300 rounded-xl p-4 text-center">
            <p class="font-bold text-emerald-800 mb-2">Lihat kaitan Tambah & Tolak:</p>
            <div class="grid grid-cols-2 gap-2 text-lg font-mono font-bold text-emerald-900">
                <div>${part1} + ${part2} = ${roof}</div><div>${part2} + ${part1} = ${roof}</div>
                <div class="text-rose-600">${roof} - ${part1} = ${part2}</div><div class="text-rose-600">${roof} - ${part2} = ${part1}</div>
            </div>
          </div>`;
        setInfo("Syabas! Operasi tolak adalah songsangan tambah."); triggerWin();
      }
    }

    /* 3. Mesin Tolak (Bentuk Lazim Visual) */
    function loadBentukLazimActivity(content) {
      setInfo("126 - 60. Klik 'Selesai Sa' untuk mula.");
      content.innerHTML = `
        <h3 class="text-4xl font-bold text-violet-500 mb-6 text-center">üî¢ Mesin Tolak</h3>
        <div class="bg-violet-50 rounded-3xl p-8 border-4 border-violet-200 max-w-xl mx-auto">
            <div class="flex justify-center gap-4 mb-2 text-sm font-bold text-slate-400 uppercase tracking-widest">
                <div style="width:70px" class="text-center">Ra</div><div style="width:70px" class="text-center">Pu</div><div style="width:70px" class="text-center">Sa</div>
            </div>
            <div class="flex justify-center gap-4 mb-2">
                <div id="ratus-1" class="lazim-box">1</div><div id="puluh-1" class="lazim-box">2</div><div id="sa-1" class="lazim-box">6</div>
            </div>
            <div class="flex justify-center gap-4 mb-4 relative">
                <div class="absolute left-4 top-2 text-5xl font-bold text-rose-500">-</div>
                <div class="lazim-box bg-transparent border-0 opacity-0"></div><div class="lazim-box">6</div><div class="lazim-box">0</div>
            </div>
            <div class="border-b-4 border-slate-400 w-3/4 mx-auto mb-4 rounded-full"></div>
            <div class="flex justify-center gap-4 mb-8">
                <div id="ratus-j" class="lazim-box bg-violet-100 text-violet-400">?</div><div id="puluh-j" class="lazim-box bg-violet-100 text-violet-400">?</div><div id="sa-j" class="lazim-box bg-violet-100 text-violet-400">?</div>
            </div>
            <div class="flex flex-col gap-3">
                <button id="btn-sa" onclick="selesaiSa()" class="btn-3d bg-violet-500 text-white font-bold py-3 rounded-xl text-lg">1. Selesai Sa</button>
                <button id="btn-puluh" onclick="selesaiPuluh()" class="btn-3d bg-slate-300 text-white font-bold py-3 rounded-xl text-lg" disabled>2. Selesai Puluh</button>
                <button id="btn-ratus" onclick="selesaiRatus()" class="btn-3d bg-slate-300 text-white font-bold py-3 rounded-xl text-lg" disabled>3. Selesai Ratus</button>
            </div>
            <p id="lazim-msg" class="text-center font-bold text-violet-600 mt-4 min-h-[30px]"></p>
        </div>
      `;
    }

    window.selesaiSa = function() {
      document.getElementById('sa-j').textContent = '6'; document.getElementById('sa-j').classList.add('dapat');
      setInfo("6 tolak 0 ialah 6. Seterusnya Puluh."); speak("6 tolak 0 ialah 6.");
      document.getElementById('btn-sa').disabled = true; document.getElementById('btn-sa').className = "btn-3d bg-slate-300 text-white font-bold py-3 rounded-xl text-lg";
      const btnP = document.getElementById('btn-puluh'); btnP.disabled = false; btnP.className = "btn-3d bg-violet-500 text-white font-bold py-3 rounded-xl text-lg";
    }

    window.selesaiPuluh = function() {
      setInfo("2 tak cukup. Pinjam dari Ratus."); speak("Pinjam dari Ratus.");
      document.getElementById('puluh-1').classList.add('shake');
      const btnP = document.getElementById('btn-puluh'); btnP.textContent = "üîÑ Pinjam dari Ratus"; btnP.onclick = pinjamRatus;
    }

    window.pinjamRatus = function() {
      document.getElementById('ratus-1').classList.add('pinjam');
      document.getElementById('ratus-1').innerHTML = '<span class="num-atas">0</span>1';
      
      document.getElementById('puluh-1').classList.add('dapat');
      document.getElementById('puluh-1').innerHTML = '<span class="num-atas">12</span>2';
      
      setInfo("Sekarang ada 12 Puluh. 12 tolak 6?"); speak("Sekarang 12 tolak 6.");
      const btnP = document.getElementById('btn-puluh'); btnP.textContent = "‚úÖ Selesai Puluh (12 - 6)"; btnP.onclick = selesaiPuluhSemula;
    }

    window.selesaiPuluhSemula = function() {
      document.getElementById('puluh-j').textContent = '6'; document.getElementById('puluh-j').classList.add('dapat');
      document.getElementById('btn-puluh').disabled = true; document.getElementById('btn-puluh').className = "btn-3d bg-slate-300 text-white font-bold py-3 rounded-xl text-lg";
      const btnR = document.getElementById('btn-ratus'); btnR.disabled = false; btnR.className = "btn-3d bg-violet-500 text-white font-bold py-3 rounded-xl text-lg";
    }

    window.selesaiRatus = function() {
      document.getElementById('ratus-j').textContent = '0'; document.getElementById('ratus-j').classList.add('dapat');
      setInfo("Siap! Jawapannya 66."); speak("Siap! Jawapannya 66.");
      document.getElementById('btn-ratus').disabled = true; document.getElementById('btn-ratus').className = "btn-3d bg-slate-300 text-white font-bold py-3 rounded-xl text-lg";
      triggerWin();
    }

    /* 4. Bedah Cerita */
    function loadWordProblemActivity(content) {
      setInfo("Klik perkataan berwarna untuk isi kotak.");
      content.innerHTML = `
        <h3 class="text-4xl font-bold text-orange-500 mb-6 text-center">üçé Bedah Cerita</h3>
        <div class="bg-orange-50 rounded-3xl p-6 border-4 border-orange-200 mb-8">
            <p class="text-2xl text-slate-700 leading-relaxed font-medium text-center">
                "Dalam bakul ada <strong class="clickable-word text-orange-600" onclick="extractInfo('126', 'wp-jumlah')">126 biji</strong> buah. 
                <strong class="clickable-word text-orange-600" onclick="extractInfo('60', 'wp-ambil')">60 biji</strong> adalah manggis. Bakinya rambutan."
            </p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="bg-white p-4 rounded-2xl border-2 border-slate-200 text-center">
                <div class="text-xs font-bold uppercase text-slate-400 mb-2">Jumlah</div>
                <div id="wp-jumlah" class="text-3xl font-black text-slate-300 drop-zone flex items-center justify-center h-16">?</div>
            </div>
            <div class="bg-white p-4 rounded-2xl border-2 border-slate-200 text-center">
                <div class="text-xs font-bold uppercase text-slate-400 mb-2">Manggis</div>
                <div id="wp-ambil" class="text-3xl font-black text-slate-300 drop-zone flex items-center justify-center h-16">?</div>
            </div>
            <div class="bg-white p-4 rounded-2xl border-2 border-slate-200 text-center">
                <div class="text-xs font-bold uppercase text-slate-400 mb-2">Rambutan (Baki)</div>
                <div id="wp-baki" class="text-3xl font-black text-orange-600 flex items-center justify-center h-16">?</div>
            </div>
        </div>
        <div id="wp-interaction" class="text-center opacity-50 pointer-events-none transition-opacity">
            <p class="text-xl font-bold text-slate-600 mb-4">Kira: 126 - 60 = ?</p>
            <div class="flex justify-center gap-2">
                <input type="number" id="wp-answer" class="border-4 border-orange-300 rounded-xl p-3 text-2xl font-bold w-32 text-center outline-none focus:border-orange-500" placeholder="?">
                <button onclick="checkWpAnswer(126, 60)" class="btn-3d bg-orange-500 text-white font-bold py-2 px-6 rounded-xl text-lg">Semak</button>
            </div>
            <p id="wp-feedback" class="mt-4 font-bold text-lg min-h-[30px]"></p>
        </div>
      `;
    }
    window.extractInfo = function(val, id) {
       const el = document.getElementById(id); el.textContent = val;
       el.classList.remove('text-slate-300'); el.classList.add('text-slate-800', 'drop-zone-filled');
       speak(val);
       if(document.getElementById('wp-jumlah').textContent !== '?' && document.getElementById('wp-ambil').textContent !== '?') {
           document.getElementById('wp-interaction').classList.remove('opacity-50', 'pointer-events-none');
           setInfo("Sekarang, kira bakinya.");
       }
    }
    window.checkWpAnswer = function(total, sub) {
       const ans = parseInt(document.getElementById('wp-answer').value);
       if(ans === (total - sub)) {
           document.getElementById('wp-feedback').textContent = "Betul! 66 biji rambutan."; document.getElementById('wp-feedback').className = "mt-4 font-bold text-lg text-green-600";
           triggerWin(); setInfo("Tahniah! Jawapan betul.");
       } else {
           document.getElementById('wp-feedback').textContent = "Salah. Cuba kira lagi."; document.getElementById('wp-feedback').className = "mt-4 font-bold text-lg text-rose-600";
           document.getElementById('wp-answer').classList.add('shake'); setTimeout(()=>document.getElementById('wp-answer').classList.remove('shake'), 500);
       }
    }

    /* 5. Bina Cerita */
    function loadStoryBuilderActivity(content) {
      setInfo("Pilih nombor untuk bina cerita.");
      content.innerHTML = `
        <h3 class="text-4xl font-bold text-rose-500 mb-6 text-center">‚úèÔ∏è Bina Cerita</h3>
        <div class="bg-white rounded-3xl p-8 border-4 border-rose-200 max-w-2xl mx-auto text-center shadow-sm">
            <div class="text-2xl leading-loose font-medium text-slate-700">
                Ali ada <select id="sb-num1" onchange="updateStory()" class="font-bold text-rose-600 bg-rose-50 border-2 border-rose-200 rounded-lg px-2 py-1 cursor-pointer hover:bg-rose-100"><option value="50">50</option><option value="80">80</option><option value="120">120</option></select>
                biji <select id="sb-item" onchange="updateStory()" class="font-bold text-rose-600 bg-rose-50 border-2 border-rose-200 rounded-lg px-2 py-1 cursor-pointer hover:bg-rose-100"><option value="guli">guli üîÆ</option><option value="epal">epal üçé</option><option value="buku">buku üìö</option></select>.
                <br>Dia beri <select id="sb-num2" onchange="updateStory()" class="font-bold text-rose-600 bg-rose-50 border-2 border-rose-200 rounded-lg px-2 py-1 cursor-pointer hover:bg-rose-100"><option value="10">10</option><option value="20">20</option><option value="30">30</option></select> kepada Siti.
            </div>
            <div class="mt-8 bg-rose-50 p-4 rounded-2xl">
                <p class="text-slate-500 font-bold text-sm uppercase mb-2">Ayat Matematik:</p>
                <p id="sb-math" class="text-4xl font-black text-rose-700 mb-4 tracking-widest">50 - 10 = ?</p>
                <div class="flex justify-center gap-3">
                    <input type="number" id="sb-answer" class="border-4 border-rose-300 rounded-xl p-3 text-2xl font-bold w-32 text-center outline-none focus:border-rose-500" placeholder="?">
                    <button onclick="checkSbAnswer()" class="btn-3d bg-rose-500 text-white font-bold py-2 px-6 rounded-xl text-lg">Semak</button>
                </div>
                <p id="sb-feedback" class="mt-3 font-bold min-h-[24px]"></p>
            </div>
        </div>
      `;
      updateStory();
    }
    window.updateStory = function() {
        const n1 = document.getElementById('sb-num1').value;
        const n2 = document.getElementById('sb-num2').value;
        document.getElementById('sb-math').textContent = `${n1} - ${n2} = ?`;
        document.getElementById('sb-answer').value = '';
        document.getElementById('sb-feedback').textContent = '';
    }
    window.checkSbAnswer = function() {
        const n1 = parseInt(document.getElementById('sb-num1').value);
        const n2 = parseInt(document.getElementById('sb-num2').value);
        const ans = parseInt(document.getElementById('sb-answer').value);
        if(ans === (n1 - n2)) {
            document.getElementById('sb-feedback').textContent = "Tepat sekali!"; document.getElementById('sb-feedback').className = "mt-3 font-bold text-green-600";
            triggerWin(); speak("Tepat sekali!");
        } else {
            document.getElementById('sb-feedback').textContent = "Salah. Cuba lagi."; document.getElementById('sb-feedback').className = "mt-3 font-bold text-rose-600";
            document.getElementById('sb-answer').classList.add('shake'); setTimeout(()=>document.getElementById('sb-answer').classList.remove('shake'), 500);
        }
    }

  </script>
</body>
</html>
